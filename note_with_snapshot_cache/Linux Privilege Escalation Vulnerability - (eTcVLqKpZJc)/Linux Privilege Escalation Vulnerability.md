## Linux Privilege Escalation Vulnerability
### Program that Gives Root Access [![[/snapshots/eTcVLqKpZJc/00-00-10.png]]](<https://youtu.be/eTcVLqKpZJc?t=7s>)

A vulnerability in certain Linux operating systems allows attackers to gain high-privileged access. This local privilege escalation essentially renders authorization meaningless in Linux systems. Most major Linux distributions, such as Ubuntu, Debian, Fedora, and CentOS, have been affected. [![[/snapshots/eTcVLqKpZJc/00-07-38.png]]](<https://youtu.be/eTcVLqKpZJc?t=455s>)

### PolicyKit and the Vulnerable Code [![[/snapshots/eTcVLqKpZJc/00-01-46.png]]](<https://youtu.be/eTcVLqKpZJc?t=104s>)

The vulnerable code is found in an executable named pkxx, which is part of the PolicyKit suite of tools. PolicyKit comes pre-installed in many Linux distributions. Pkxx is an executable that allows users to execute commands as other users, similar to sudo. The vulnerability lies in the fact that the code reads and writes environment variables, including insecure ones. [![[/snapshots/eTcVLqKpZJc/00-01-59.png]]](<https://youtu.be/eTcVLqKpZJc?t=116s>)

### Out-of-bound Read/Write and Environment Variables [![[/snapshots/eTcVLqKpZJc/00-11-49.png]]](<https://youtu.be/eTcVLqKpZJc?t=706s>)

Two major issues are: out-of-bound read and out-of-bound write. With these primitives, attackers can inject environment variables. Some insecure environment variables, such as LD_PRELOAD, are automatically filtered by LDSO on set UID bit programs or programs that run as another user. However, an out-of-bound write primitive could be used to inject the insecure GCONV_PATH environment variable. The idea is to trigger an error by setting CHARSET to something other than UTF-8. This would then trigger g_print_error, which would convert the CHARSET using a conversion module specified by the attacker via the GCONV_PATH environment variable. [![[/snapshots/eTcVLqKpZJc/00-11-21.png]]](<https://youtu.be/eTcVLqKpZJc?t=677s>)

### Crafting the Exploit

The exploit involves creating a malicious shared library as a conversion module using the GCONV_PATH environment variable. This would then be used to execute shell commands as a root user. The full exploit code is available on the GitHub repository for interested users.  [![[/snapshots/eTcVLqKpZJc/00-15-05.png]]](<https://youtu.be/eTcVLqKpZJc?t=903s>)

### Vulnerability Discovered Previously

The vulnerability was discovered before, in 2013 by Ryren, but was not exploited at that time. A CTF challenge in 2019 also revolved around a similar exploit. Qualys finally linked these concepts and enabled this 0-day exploit. Updating the PolicyKit or removing the PK_Exec executable is advised, as well as using tools like Sneak CLI to detect and fix this vulnerability in container images. [![[/snapshots/eTcVLqKpZJc/00-17-05.png]]](<https://youtu.be/eTcVLqKpZJc?t=1023s>)


Source: [(167) Dangerous Code Hidden in Plain Sight for 12 years - YouTube](https://www.youtube.com/watch?v=eTcVLqKpZJc&list=WL&index=15&t=2s)
